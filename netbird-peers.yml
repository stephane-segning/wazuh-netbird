services:
  netbird-peer-wazuh:
    image: netbirdio/netbird:0.60.8
    container_name: netbird-peer-wazuh
    networks:
      - wazuh_net
    cap_add:
      - NET_ADMIN
      - SYS_ADMIN
      - SYS_RESOURCE
    devices:
      - /dev/net/tun:/dev/net/tun
    environment:
      - NB_SETUP_KEY=${NB_SETUP_KEY}
    command: ["sh", "-lc", "netbird up --setup-key ${NB_SETUP_KEY} && tail -f /dev/null"]
    depends_on:
      - wazuh.manager

  netbird-peer-1:
    image: netbirdio/netbird:0.60.8
    container_name: netbird-peer-1
    networks:
      - nb1_net
    cap_add:
      - NET_ADMIN
      - SYS_ADMIN
      - SYS_RESOURCE
    devices:
      - /dev/net/tun:/dev/net/tun
    environment:
      - NB_SETUP_KEY=${NB_SETUP_KEY}
    command: ["sh", "-lc", "netbird up --setup-key ${NB_SETUP_KEY} && tail -f /dev/null"]

  netbird-peer-2:
    image: netbirdio/netbird:0.60.8
    container_name: netbird-peer-2
    networks:
      - nb2_net
    cap_add:
      - NET_ADMIN
      - SYS_ADMIN
      - SYS_RESOURCE
    devices:
      - /dev/net/tun:/dev/net/tun
    environment:
      - NB_SETUP_KEY=${NB_SETUP_KEY}
    command: ["sh", "-lc", "netbird up --setup-key ${NB_SETUP_KEY} && tail -f /dev/null"]

  netbird-peer-3:
    image: netbirdio/netbird:0.60.8
    container_name: netbird-peer-3
    networks:
      - nb3_net
    cap_add:
      - NET_ADMIN
      - SYS_ADMIN
      - SYS_RESOURCE
    devices:
      - /dev/net/tun:/dev/net/tun
    environment:
      - NB_SETUP_KEY=${NB_SETUP_KEY}
    command: ["sh", "-lc", "netbird up --setup-key ${NB_SETUP_KEY} && tail -f /dev/null"]

networks:
  nb1_net:
    driver: bridge
  nb2_net:
    driver: bridge
  nb3_net:
    driver: bridge
